<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="last-modified" content="2017-08-04 00:25:03 +0200">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- meta "search-domain" used for google site search function google_search() -->
    <meta name="search-domain" value="/swc-releases/2017.08/sql-novice-survey">
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="../assets/css/lesson.css" />
    
    <link rel="shortcut icon" type="image/x-icon" href="/favicon-swc.ico" />
    
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
	<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
	<![endif]-->
    <title>Databases and SQL: Creating and Modifying Data</title>
  </head>
  <body>
    <div class="container">
      <nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      
      
      <a href="https://software-carpentry.org" class="pull-left">
        <img class="navbar-logo" src="../assets/img/swc-icon-blue.svg" alt="Software Carpentry logo" />
      </a>
      

      
      <a class="navbar-brand" href="../">Home</a>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">

	
        <li><a href="../conduct/">Code of Conduct</a></li>

	
        
        <li><a href="../setup/">Setup</a></li>
        <li><a href="../reference/">Reference</a></li>
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Episodes <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../01-select/">Selecting Data</a></li>
            
            <li><a href="../02-sort-dup/">Sorting and Removing Duplicates</a></li>
            
            <li><a href="../03-filter/">Filtering</a></li>
            
            <li><a href="../04-calc/">Calculating New Values</a></li>
            
            <li><a href="../05-null/">Missing Data</a></li>
            
            <li><a href="../06-agg/">Aggregation</a></li>
            
            <li><a href="../07-join/">Combining Data</a></li>
            
            <li><a href="../08-hygiene/">Data Hygiene</a></li>
            
            <li><a href="../09-create/">Creating and Modifying Data</a></li>
            
            <li><a href="../10-prog/">Programming with Databases - Python</a></li>
            
            <li><a href="../11-prog-R/">Programming with Databases - R</a></li>
            
          </ul>
        </li>
	

	
	
        <li class="dropdown">
          <a href="../" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Extras <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            <li><a href="../about/">About</a></li>
            
            <li><a href="../discuss/">Discussion</a></li>
            
            <li><a href="../figures/">Figures</a></li>
            
            <li><a href="../guide/">Instructor Notes</a></li>
            
          </ul>
        </li>
	

	
        <li><a href="../license/">License</a></li>
      </ul>
      <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form>
    </div>
  </div>
</nav>





<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../08-hygiene/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
    <h3 class="maintitle"><a href="../">Databases and SQL</a></h3>
    <h1 class="maintitle">Creating and Modifying Data</h1>
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../10-prog/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


<blockquote class="objectives">
  <h2>Overview</h2>

  <div class="row">
    <div class="col-md-3">
      <strong>Teaching:</strong> 15 min
      <br/>
      <strong>Exercises:</strong> 10 min
    </div>
    <div class="col-md-9">
      <strong>Questions</strong>
      <ul>
	
	<li><p>How can I create, modify, and delete tables and data?</p>
</li>
	
      </ul>
    </div>
  </div>

  <div class="row">
    <div class="col-md-3">
    </div>
    <div class="col-md-9">
      <strong>Objectives</strong>
      <ul>
	
	<li><p>Write statements that creates tables.</p>
</li>
	
	<li><p>Write statements to insert, modify, and delete records.</p>
</li>
	
      </ul>
    </div>
  </div>

</blockquote>

<p>So far we have only looked at how to get information out of a database,
both because that is more frequent than adding information,
and because most other operations only make sense
once queries are understood.
If we want to create and modify data,
we need to know two other sets of commands.</p>

<p>The first pair are <a href="https://www.sqlite.org/lang_createtable.html"><code class="highlighter-rouge">CREATE TABLE</code></a> and <a href="https://www.sqlite.org/lang_droptable.html"><code class="highlighter-rouge">DROP TABLE</code></a>.
While they are written as two words,
they are actually single commands.
The first one creates a new table;
its arguments are the names and types of the table’s columns.
For example,
the following statements create the four tables in our survey database:</p>

<div class="sql highlighter-rouge"><pre class="highlight"><code>CREATE TABLE Person(id text, personal text, family text);
CREATE TABLE Site(name text, lat real, long real);
CREATE TABLE Visited(id integer, site text, dated text);
CREATE TABLE Survey(taken integer, person text, quant real, reading real);
</code></pre>
</div>

<p>We can get rid of one of our tables using:</p>

<div class="sql highlighter-rouge"><pre class="highlight"><code>DROP TABLE Survey;
</code></pre>
</div>

<p>Be very careful when doing this:
most databases have some support for undoing changes,
but it’s better not to have to rely on it.</p>

<p>Different database systems support different data types for table columns,
but most provide the following:</p>

<p>data type  use
———  —————————————–
INTEGER    a signed integer
REAL       a floating point number
TEXT       a character string
BLOB       a “binary large object”, such as an image</p>

<p>Most databases also support Booleans and date/time values;
SQLite uses the integers 0 and 1 for the former,
and represents the latter as discussed <a href="#a:dates">earlier</a>.
An increasing number of databases also support geographic data types,
such as latitude and longitude.
Keeping track of what particular systems do or do not offer,
and what names they give different data types,
is an unending portability headache.</p>

<p>When we create a table,
we can specify several kinds of constraints on its columns.
For example,
a better definition for the <code class="highlighter-rouge">Survey</code> table would be:</p>

<div class="sql highlighter-rouge"><pre class="highlight"><code>CREATE TABLE Survey(
    taken   integer not null, -- where reading taken
    person  text,             -- may not know who took it
    quant   real not null,    -- the quantity measured
    reading real not null,    -- the actual reading
    primary key(taken, quant),
    foreign key(taken) references Visited(id),
    foreign key(person) references Person(id)
);
</code></pre>
</div>

<p>Once again,
exactly what constraints are available
and what they’re called
depends on which database manager we are using.</p>

<p>Once tables have been created,
we can add, change, and remove records using our other set of commands,
<code class="highlighter-rouge">INSERT</code>, <code class="highlighter-rouge">UPDATE</code>, and <code class="highlighter-rouge">DELETE</code>.</p>

<p>The simplest form of <code class="highlighter-rouge">INSERT</code> statement lists values in order:</p>

<div class="sql highlighter-rouge"><pre class="highlight"><code>INSERT INTO Site values('DR-1', -49.85, -128.57);
INSERT INTO Site values('DR-3', -47.15, -126.72);
INSERT INTO Site values('MSK-4', -48.87, -123.40);
</code></pre>
</div>

<p>We can also insert values into one table directly from another:</p>

<div class="sql highlighter-rouge"><pre class="highlight"><code>CREATE TABLE JustLatLong(lat text, long text);
INSERT INTO JustLatLong SELECT lat, long FROM Site;
</code></pre>
</div>

<p>Modifying existing records is done using the <code class="highlighter-rouge">UPDATE</code> statement.
To do this we tell the database which table we want to update,
what we want to change the values to for any or all of the fields,
and under what conditions we should update the values.</p>

<p>For example, if we made a mistake when entering the lat and long values
of the last <code class="highlighter-rouge">INSERT</code> statement above:</p>

<div class="sql highlighter-rouge"><pre class="highlight"><code>UPDATE Site SET lat=-47.87, long=-122.40 WHERE name='MSK-4';
</code></pre>
</div>

<p>Be careful to not forget the <code class="highlighter-rouge">where</code> clause or the update statement will
modify <em>all</em> of the records in the database.</p>

<p>Deleting records can be a bit trickier,
because we have to ensure that the database remains internally consistent.
If all we care about is a single table,
we can use the <code class="highlighter-rouge">DELETE</code> command with a <code class="highlighter-rouge">WHERE</code> clause
that matches the records we want to discard.
For example,
once we realize that Frank Danforth didn’t take any measurements,
we can remove him from the <code class="highlighter-rouge">Person</code> table like this:</p>

<div class="sql highlighter-rouge"><pre class="highlight"><code>DELETE FROM Person WHERE id = 'danforth';
</code></pre>
</div>

<p>But what if we removed Anderson Lake instead?
Our <code class="highlighter-rouge">Survey</code> table would still contain seven records
of measurements he’d taken,
but that’s never supposed to happen:
<code class="highlighter-rouge">Survey.person</code> is a foreign key into the <code class="highlighter-rouge">Person</code> table,
and all our queries assume there will be a row in the latter
matching every value in the former.</p>

<p>This problem is called <a href="/swc-releases/2017.08/sql-novice-survey/reference/#referential-integrity">referential integrity</a>:
we need to ensure that all references between tables can always be resolved correctly.
One way to do this is to delete all the records
that use <code class="highlighter-rouge">'lake'</code> as a foreign key
before deleting the record that uses it as a primary key.
If our database manager supports it,
we can automate this
using <a href="/swc-releases/2017.08/sql-novice-survey/reference/#cascading-delete">cascading delete</a>.
However,
this technique is outside the scope of this chapter.</p>

<blockquote class="callout">
  <h2 id="hybrid-storage-models">Hybrid Storage Models</h2>

  <p>Many applications use a hybrid storage model
instead of putting everything into a database:
the actual data (such as astronomical images) is stored in files,
while the database stores the files’ names,
their modification dates,
the region of the sky they cover,
their spectral characteristics,
and so on.
This is also how most music player software is built:
the database inside the application keeps track of the MP3 files,
but the files themselves live on disk.</p>
</blockquote>

<blockquote class="challenge">
  <h2 id="replacing-null">Replacing NULL</h2>

  <p>Write an SQL statement to replace all uses of <code class="highlighter-rouge">null</code> in
<code class="highlighter-rouge">Survey.person</code> with the string <code class="highlighter-rouge">'unknown'</code>.</p>
</blockquote>

<blockquote class="challenge">
  <h2 id="generating-insert-statements">Generating Insert Statements</h2>

  <p>One of our colleagues has sent us a <a href="/swc-releases/2017.08/sql-novice-survey/reference/#comma-separated-values">CSV</a> file containing
temperature readings by Robert Olmstead, which is formatted like
this:</p>

  <div class="output highlighter-rouge"><pre class="highlight"><code>Taken,Temp
619,-21.5
622,-15.5
</code></pre>
  </div>

  <p>Write a small Python program that reads this file in and prints out
the SQL <code class="highlighter-rouge">INSERT</code> statements needed to add these records to the
survey database.  Note: you will need to add an entry for Olmstead
to the <code class="highlighter-rouge">Person</code> table.  If you are testing your program repeatedly,
you may want to investigate SQL’s <code class="highlighter-rouge">INSERT or REPLACE</code> command.</p>
</blockquote>

<blockquote class="challenge">
  <h2 id="backing-up-with-sql">Backing Up with SQL</h2>

  <p>SQLite has several administrative commands that aren’t part of the
SQL standard.  One of them is <code class="highlighter-rouge">.dump</code>, which prints the SQL commands
needed to re-create the database.  Another is <code class="highlighter-rouge">.load</code>, which reads a
file created by <code class="highlighter-rouge">.dump</code> and restores the database.  A colleague of
yours thinks that storing dump files (which are text) in version
control is a good way to track and manage changes to the database.
What are the pros and cons of this approach?  (Hint: records aren’t
stored in any particular order.)</p>
</blockquote>


<blockquote class="keypoints">
  <h2>Key Points</h2>
  <ul>
    
    <li><p>Use CREATE and DROP to create and delete tables.</p>
</li>
    
    <li><p>Use INSERT to add data.</p>
</li>
    
    <li><p>Use UPDATE to modify existing data.</p>
</li>
    
    <li><p>Use DELETE to remove data.</p>
</li>
    
    <li><p>It is simpler and safer to modify data when every record has a unique primary key.</p>
</li>
    
    <li><p>Do not create dangling references by deleting records that other records refer to.</p>
</li>
    
  </ul>
</blockquote>





<div class="row">
  <div class="col-md-1">
    <h3>
      
      <a href="../08-hygiene/"><span class="glyphicon glyphicon-menu-left" aria-hidden="true"></span><span class="sr-only">previous episode</span></a>
      
    </h3>
  </div>
  <div class="col-md-10">
    
  </div>
  <div class="col-md-1">
    <h3>
      
      <a href="../10-prog/"><span class="glyphicon glyphicon-menu-right" aria-hidden="true"></span><span class="sr-only">next episode</span></a>
      
    </h3>
  </div>
</div>


      
      <footer>
  <div class="row">
    <div class="col-md-6" align="left">
      <h4>
	Copyright &copy; 2016
	<a href="https://software-carpentry.org">Software Carpentry Foundation</a>
	
      </h4>
    </div>
    <div class="col-md-6" align="right">
      <h4>
	<a href="/">Source</a>
	/
	<a href="/blob/gh-pages/CONTRIBUTING.md">Contributing</a>
	/
	<a href="mailto:lessons@software-carpentry.org">Contact</a>
      </h4>
    </div>
  </div>
</footer>

      
    </div>
    <script src="../assets/js/jquery.min.js"></script>
<script src="../assets/js/bootstrap.min.js"></script>
<script src="../assets/js/lesson.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-37305346-2', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>
